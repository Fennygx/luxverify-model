<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <title>LuxVerify Beta</title>
</head>
<body>
  <input type="file" id="upload" accept="image/*">
  <div id="output"></div>
  <script>
    async function loadModel() {
      try {
        const model = await tf.loadLayersModel('https://cdn.jsdelivr.net/gh/fennygx/luxverify-model@main/model.json');
        return model;
      } catch (err) {
        console.error('Model load error:', err);
        document.getElementById('output').innerHTML = 'Error loading model. Try again later.';
        return null;
      }
    }

    let model;
    loadModel().then(loadedModel => {
      model = loadedModel;
      if (model) document.getElementById('output').innerHTML = 'Model loaded. Upload an image to start.';
    });

    document.getElementById('upload').addEventListener('change', async (e) => {
      const img = e.target.files[0];
      if (!model) {
        document.getElementById('output').innerHTML = 'Model not loaded yet...';
        return;
      }
      const tensor = tf.browser.fromPixels(img).resizeNearestNeighbor([224, 224]).toFloat().div(255).expandDims();
      try {
        const prediction = await model.predict(tensor).dataSync();
        const confidence = Math.max(...prediction) * 100;
        document.getElementById('output').innerHTML = `Confidence: ${confidence.toFixed(2)}% Replica`;
      } catch (err) {
        document.getElementById('output').innerHTML = 'Error processing image.';
      }
    });
  </script>
</body>
</html>